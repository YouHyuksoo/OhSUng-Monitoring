# ğŸ“ Modbus ì£¼ì†Œ ë³€í™˜ ê°€ì´ë“œ

Modbus TCPì™€ PLCì˜ D ì£¼ì†Œ ì²´ê³„ë¥¼ ì´í•´í•˜ëŠ” ì™„ë²½í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ¯ í˜„ì¬ ë³€í™˜ ë°©ì‹

### í˜„ì¬ ì½”ë“œ (debug-modbus.js)

```javascript
/**
 * D ì£¼ì†Œë¥¼ Modbus ë ˆì§€ìŠ¤í„°ë¡œ ë³€í™˜
 */
addressToRegister(address) {
  // D400 â†’ 400, D430 â†’ 430 ë“± ì¶”ì¶œ
  const match = address.match(/D(\d+)/);
  if (!match) {
    throw new Error(`Invalid address format: ${address}`);
  }
  const dAddress = parseInt(match[1]);
  // í˜„ì¬: D400 â†’ ë ˆì§€ìŠ¤í„° 400 (ì§ì ‘ ë§¤í•‘)
  return dAddress;
}
```

### ë³€í™˜ ì›ë¦¬

| D ì£¼ì†Œ | ì •ê·œì‹ ì¶”ì¶œ | í˜„ì¬ ë³€í™˜ | ë¹„ê³  |
|--------|-----------|---------|------|
| `D400` | `400` | `400` | ì˜¨ë„ì„¼ì„œ 1ë²ˆ |
| `D410` | `410` | `410` | ì˜¨ë„ì„¼ì„œ 2ë²ˆ |
| `D430` | `430` | `430` | ì˜¨ë„ì„¼ì„œ ì„¤ì •ê°’ |
| `D4000` | `4000` | `4000` | ì „ë ¥ ë°ì´í„° |
| `D4010` | `4010` | `4010` | ì „ë ¥ ë°ì´í„° 2 |

**í˜„ì¬ ë°©ì‹: `D + ë²ˆí˜¸ = ë ˆì§€ìŠ¤í„° ë²ˆí˜¸`** (1:1 ì§ì ‘ ë§¤í•‘)

---

## ğŸ”„ Modbus í”„ë¡œí† ì½œ ê¸°ë³¸ê°œë…

### Modbus í•¨ìˆ˜ ì¢…ë¥˜

Modbus TCPì—ëŠ” ì—¬ëŸ¬ í•¨ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤:

| FC | ì´ë¦„ | ìš©ë„ | ë²”ìœ„ |
|----|------|------|------|
| **FC03** | Read Holding Registers | ë°ì´í„° ì½ê¸° | 0~65535 |
| FC04 | Read Input Registers | ì…ë ¥ ì½ê¸° | 0~65535 |
| FC06 | Write Single Register | ë°ì´í„° ì“°ê¸° | 0~65535 |
| FC16 | Write Multiple Registers | ë‹¤ì¤‘ ì“°ê¸° | 0~65535 |

**í˜„ì¬ ì‚¬ìš© ì¤‘:** FC03 (readHoldingRegisters)

### Modbus ë ˆì§€ìŠ¤í„° ì£¼ì†Œ ê³µê°„

```
ë ˆì§€ìŠ¤í„° 0     â†’ ì²« ë²ˆì§¸ 16ë¹„íŠ¸ ë°ì´í„°
ë ˆì§€ìŠ¤í„° 1     â†’ ë‘ ë²ˆì§¸ 16ë¹„íŠ¸ ë°ì´í„°
ë ˆì§€ìŠ¤í„° 400   â†’ D400 ì£¼ì†Œ ë°ì´í„° (í˜„ì¬ ë§¤í•‘)
ë ˆì§€ìŠ¤í„° 4000  â†’ D4000 ì£¼ì†Œ ë°ì´í„° (í˜„ì¬ ë§¤í•‘)
```

---

## ğŸ” ì‹¤ì œ ë™ì‘ ê³¼ì •

### 1ï¸âƒ£ **ì£¼ì†Œ ì…ë ¥**
```bash
npm run debug:modbus 192.168.111.186 502 1 D400 D430
```

### 2ï¸âƒ£ **ì •ê·œì‹ìœ¼ë¡œ ë²ˆí˜¸ ì¶”ì¶œ**
```javascript
const address = "D400";
const match = address.match(/D(\d+)/);
// match = ["D400", "400"]  (ì „ì²´ ì¼ì¹˜, ìº¡ì²˜ ê·¸ë£¹)
const dAddress = parseInt(match[1]);  // 400
```

### 3ï¸âƒ£ **Modbus ë ˆì§€ìŠ¤í„°ë¡œ ë³€í™˜**
```javascript
const register = dAddress;  // í˜„ì¬: 400
// D400 â†’ ë ˆì§€ìŠ¤í„° 400ìœ¼ë¡œ ë³€í™˜
```

### 4ï¸âƒ£ **Modbus ì½ê¸° ëª…ë ¹ ì „ì†¡**
```javascript
this.client.readHoldingRegisters(register, 1, callback);
// register=400, length=1 (1ê°œ ê°’ ì½ê¸°)
```

### 5ï¸âƒ£ **PLC ì‘ë‹µ**
```
PLC: "ë ˆì§€ìŠ¤í„° 400ì˜ ê°’ì€ 0ì…ë‹ˆë‹¤"
íŒŒì‹±: { "D400": 0 }
```

---

## ğŸ“Š ì‹¤í–‰ ì˜ˆì‹œ ë° ë¡œê·¸

### ëª…ë ¹
```bash
npm run debug:modbus 192.168.111.186 502 1 D400 D430
```

### ë‚´ë¶€ ë³€í™˜ ê³¼ì • (ì½˜ì†”)
```
ğŸ“ D400 (ë ˆì§€ìŠ¤í„° 400) ì½ëŠ” ì¤‘...
   âœ… ê°’: 0

ğŸ“ D430 (ë ˆì§€ìŠ¤í„° 430) ì½ëŠ” ì¤‘...
   âœ… ê°’: 0
```

### ê²°ê³¼
```json
{
  "D400": 0,
  "D430": 0
}
```

---

## âš™ï¸ ë³€í™˜ ë°©ì‹ ìˆ˜ì • ê°€ì´ë“œ

í˜„ì¬ëŠ” **1:1 ì§ì ‘ ë§¤í•‘**ì´ì§€ë§Œ, ì‹¤ì œ PLCì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì˜¤í”„ì…‹ì´ ìˆëŠ” ê²½ìš°

**ë¬¸ì œ:** D400ì´ ì‹¤ì œë¡œëŠ” ë ˆì§€ìŠ¤í„° 0ì— ìˆëŠ” ê²½ìš°

```javascript
// ìˆ˜ì • ì „
addressToRegister(address) {
  const match = address.match(/D(\d+)/);
  const dAddress = parseInt(match[1]);
  return dAddress;  // D400 â†’ 400
}

// ìˆ˜ì • í›„ (ì˜¤í”„ì…‹ -400)
addressToRegister(address) {
  const match = address.match(/D(\d+)/);
  const dAddress = parseInt(match[1]);
  return dAddress - 400;  // D400 â†’ 0, D401 â†’ 1, ...
}
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë³µì¡í•œ ë§¤í•‘

**ì˜ˆ:** D400~D470ì€ ë¸”ë¡ 0, D4000~D4099ëŠ” ë¸”ë¡ 1

```javascript
addressToRegister(address) {
  const match = address.match(/D(\d+)/);
  const dAddress = parseInt(match[1]);

  if (dAddress >= 400 && dAddress <= 470) {
    // ë¸”ë¡ 0: D400 â†’ 0, D401 â†’ 1, ...
    return dAddress - 400;
  } else if (dAddress >= 4000 && dAddress <= 4099) {
    // ë¸”ë¡ 1: D4000 â†’ 0, D4001 â†’ 1, ...
    return dAddress - 4000 + 100;  // ë¸”ë¡ 1 ì‹œì‘ ìœ„ì¹˜
  }
  throw new Error(`Unknown address: ${address}`);
}
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: 16ë¹„íŠ¸ â†’ 32ë¹„íŠ¸ ë³€í™˜

**ë¬¸ì œ:** 2ê°œì˜ 16ë¹„íŠ¸ ê°’ì´ 1ê°œì˜ 32ë¹„íŠ¸ ê°’ìœ¼ë¡œ ì €ì¥ë˜ëŠ” ê²½ìš°

```javascript
addressToRegister(address) {
  const match = address.match(/D(\d+)/);
  const dAddress = parseInt(match[1]);

  // D400ì€ 32ë¹„íŠ¸ = 2ê°œ ë ˆì§€ìŠ¤í„°
  // D400 â†’ ë ˆì§€ìŠ¤í„° 0~1
  // D402 â†’ ë ˆì§€ìŠ¤í„° 2~3
  return (dAddress - 400) * 2;
}
```

---

## ğŸ”§ í˜„ì¬ ì‹œìŠ¤í…œì—ì„œ ì˜¬ë°”ë¥¸ ë³€í™˜ ì°¾ê¸°

### 1ï¸âƒ£ **í…ŒìŠ¤íŠ¸ ëª…ë ¹ ì‹¤í–‰**
```bash
npm run debug:modbus 192.168.111.186 502 1 D400
```

**ê²°ê³¼ê°€ 0ì¸ ê²½ìš°:**
- âœ… í˜„ì¬ ë§¤í•‘ì´ ë§ìŒ
- ë˜ëŠ” D400ì— ì‹¤ì œë¡œ 0 ê°’ì´ ì €ì¥ë˜ì–´ ìˆìŒ

### 2ï¸âƒ£ **ì—¬ëŸ¬ ì£¼ì†Œ í…ŒìŠ¤íŠ¸**
```bash
npm run debug:modbus 192.168.111.186 502 1 D400 D401 D402
```

**ê²°ê³¼:**
```
D400: 0
D401: 0
D402: 0
```

ì—°ì†ì ìœ¼ë¡œ 0ì´ ë‚˜ì˜¤ë©´ í˜„ì¬ ë§¤í•‘ì´ ì •ìƒì…ë‹ˆë‹¤.

### 3ï¸âƒ£ **PLC ë©”ë‰´ì–¼ í™•ì¸**

PLC ë©”ë‰´ì–¼ì—ì„œ ë‹¤ìŒì„ ì°¾ì•„ë³´ì„¸ìš”:
- **"Modbus Register Map"** ë˜ëŠ” **"Modbus Address Mapping"**
- D400ì´ ì–´ëŠ Modbus ë ˆì§€ìŠ¤í„°ì— í• ë‹¹ë˜ì–´ ìˆëŠ”ì§€
- ì˜¤í”„ì…‹ì´ ìˆëŠ”ì§€ ì—¬ë¶€

---

## ğŸ“š LS PLC (XGT) Modbus í‘œì¤€

LS ELECTRIC XGT PLCì˜ í‘œì¤€ ë§¤í•‘ (ì°¸ê³ ìš©):

```
PLC ë©”ëª¨ë¦¬    Modbus FC03 ë ˆì§€ìŠ¤í„°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
D0~D99       0~99
D100~D199    100~199
D400~D499    400~499  â† ì˜¨ë„ì„¼ì„œ
D4000~D4099  4000~4099  â† ì „ë ¥ ë°ì´í„°
```

**ìš°ë¦¬ì˜ í˜„ì¬ ë§¤í•‘ì´ ì •í™•í•˜ê²Œ ì´ ê¸°ì¤€ì„ ë”°ë¥´ê³  ìˆìŠµë‹ˆë‹¤!**

---

## ğŸ¯ ì£¼ì†Œë³„ ë°ì´í„° ì˜ë¯¸

í˜„ì¬ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©ë˜ëŠ” ì£¼ì†Œë“¤:

```javascript
// ì˜¨ë„ì„¼ì„œ (D400~D470)
D400  â†’ ì˜¨ë„ì„¼ì„œ 1ë²ˆ (í˜„ì¬ê°’)
D401  â†’ ì˜¨ë„ì„¼ì„œ 1ë²ˆ (ì„¤ì •ê°’)
D410  â†’ ì˜¨ë„ì„¼ì„œ 2ë²ˆ (í˜„ì¬ê°’)
D411  â†’ ì˜¨ë„ì„¼ì„œ 2ë²ˆ (ì„¤ì •ê°’)
D420  â†’ ì˜¨ë„ì„¼ì„œ 3ë²ˆ (í˜„ì¬ê°’)
D430  â†’ ì˜¨ë„ì„¼ì„œ 4ë²ˆ (í˜„ì¬ê°’)
D450  â†’ ì˜¨ë„ì„¼ì„œ 5ë²ˆ (í˜„ì¬ê°’)
D460  â†’ ì˜¨ë„ì„¼ì„œ 6ë²ˆ (í˜„ì¬ê°’)

// ì „ë ¥ ë°ì´í„° (D4000~D4038)
D4000 â†’ ì „ì²´ ì „ë ¥ (W)
D4010 â†’ ì „ì²´ ì „ë¥˜ (A)
D4020 â†’ ìƒë³„ ì „ë ¥ 1
D4030 â†’ ìƒë³„ ì „ë ¥ 2
```

---

## ğŸ’¡ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ: ì½ì€ ê°’ì´ í•­ìƒ 0

**ì›ì¸:**
1. âŒ Modbus ì£¼ì†Œ ë§¤í•‘ì´ ì˜ëª»ë¨
2. âŒ PLCì˜ í•´ë‹¹ ë ˆì§€ìŠ¤í„°ì— ë°ì´í„°ê°€ ì—†ìŒ
3. âŒ Slave IDê°€ ì˜ëª»ë¨

**í•´ê²°ì±…:**
```bash
# Slave ID ë³€ê²½í•´ì„œ í…ŒìŠ¤íŠ¸
npm run debug:modbus 192.168.111.186 502 1 D400
npm run debug:modbus 192.168.111.186 502 2 D400
npm run debug:modbus 192.168.111.186 502 255 D400

# PLC ë©”ë‰´ì–¼ì—ì„œ ì˜¬ë°”ë¥¸ Slave ID í™•ì¸
```

### ë¬¸ì œ: "ë ˆì§€ìŠ¤í„° 400ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŒ" ì—ëŸ¬

**ì›ì¸:**
- Modbus ë§¤í•‘ì´ ì˜ëª»ë¨
- D400ì´ ë ˆì§€ìŠ¤í„° 400ì— ì—†ìŒ

**í•´ê²°ì±…:**
```javascript
// debug-modbus.jsì˜ addressToRegister í•¨ìˆ˜ ìˆ˜ì •
// PLC ë©”ë‰´ì–¼ ì°¸ê³ í•˜ì—¬ ì˜¬ë°”ë¥¸ ì˜¤í”„ì…‹ ì°¾ê¸°

// ì˜ˆì‹œ 1: ì˜¤í”„ì…‹ì´ 0ì¼ ê²½ìš°
return dAddress;

// ì˜ˆì‹œ 2: ì˜¤í”„ì…‹ì´ -400ì¼ ê²½ìš°
return dAddress - 400;

// ì˜ˆì‹œ 3: ìŠ¤ì¼€ì¼ë§ í•„ìš”í•  ê²½ìš°
return Math.floor((dAddress - 400) / 2);
```

---

## ğŸ“– ì°¸ê³ ìë£Œ

### Modbus í‘œì¤€
- [Modbus TCP ìŠ¤í™](https://modbus.org/docs/Modbus_Application_Protocol_V1_1b3.pdf)
- [Modbus Serial ìŠ¤í™](https://modbus.org/docs/Modbus_over_serial_line_V1_02.pdf)

### LS PLC (XGT) ë§¤ë‰´ì–¼
- XGT PLC Modbus Master/Slave ì„¤ì • ê°€ì´ë“œ
- XGT PLC Modbus Register Map

### Node.js ë¼ì´ë¸ŒëŸ¬ë¦¬
- [modbus-serial](https://www.npmjs.com/package/modbus-serial) - ìš°ë¦¬ê°€ ì‚¬ìš© ì¤‘

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

PLCì—ì„œ ë°ì´í„°ë¥¼ ì •í™•íˆ ì½ê¸° ìœ„í•´:

- [ ] PLC IP ì£¼ì†Œ í™•ì¸ (192.168.111.186)
- [ ] Modbus TCP í¬íŠ¸ í™•ì¸ (502)
- [ ] Slave ID í™•ì¸ (ì¼ë°˜ì ìœ¼ë¡œ 1)
- [ ] PLC ë©”ë‰´ì–¼ì—ì„œ Modbus ì£¼ì†Œ ë§¤í•‘ í™•ì¸
- [ ] D400ë¶€í„° ìˆœì„œëŒ€ë¡œ í…ŒìŠ¤íŠ¸
- [ ] ì½ì€ ê°’ì´ ì˜ˆìƒ ë²”ìœ„ì¸ì§€ í™•ì¸

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025ë…„ 12ì›”

**í˜„ì¬ ì„¤ì •**: LS PLC (XGT) Modbus TCP í‘œì¤€ ë§¤í•‘ ì ìš©
